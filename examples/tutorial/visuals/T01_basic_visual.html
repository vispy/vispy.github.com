


<!DOCTYPE html>
<html lang="en">
<head>
        <title>tutorial/visuals/T01_basic_visual &mdash; vispy</title>
    
    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link href="../../../_static/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../../../_static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
    
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="../../../_static/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/js/jquery.anoslide.js"></script>
        <script type="text/javascript" src="../../../_static/js/carousel.js"></script>
        <link rel="top" title="vispy" href="../../../index.html" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <link rel="shortcut icon" href="../../../_static/favicon.ico">
</head>
<body class="container">
    <a href="http://vispy.org" class="logo"><img src="../../../_static/img/logo.png" alt=""></a>
    <div class="clearfix"></div>
    <div class="navbar">
        <div class="navbar-inner">
            <ul class="nav">
                <li><a href="http://vispy.org/index.html">Home</a></li>
<li><a href="http://vispy.org/gallery.html">Gallery</a></li>
<li><a href="http://api.vispy.org">Documentation</a></li>
<li><a href="https://github.com/vispy/vispy">Source</a></li>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45168532-1', 'vispy.org');
  ga('send', 'pageview');

</script>
            </ul>
            <form class="navbar-form pull-right" action="http://api.vispy.org/en/latest/search.html" method="get">
                <input type="text" class="search span3" name="q" placeholder="Search documentation ...">
                <input type="hidden" name="check_keywords" value="yes" >
                <input type="hidden" name="area" value="default" >
            </form>
        </div>
    </div>
    <div class="row">
        <div class="span9">
            
  <div class="section" id="tutorial-visuals-t01-basic-visual">
<h1>tutorial/visuals/T01_basic_visual<a class="headerlink" href="#tutorial-visuals-t01-basic-visual" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="tutorial-creating-visuals">
<h1>Tutorial: Creating Visuals<a class="headerlink" href="#tutorial-creating-visuals" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is intended to guide developers who are interested in creating
new subclasses of Visual. In most cases, this will not be necessary because
vispy&#8217;s base library of visuals will be sufficient to create complex scenes as
needed. However, there are cases where a particular visual effect is desired
that is not supported in the base library, or when a custom visual is needed to
optimize performance for a specific use case.</p>
<p>The purpose of a Visual is to encapsulate a single drawable object. This
drawable can be as simple or complex as desired. Some of the simplest visuals
draw points, lines, or triangles, whereas more complex visuals invove multiple
drawing stages or make use of sub-visuals to construct larger objects.</p>
<p>In this example we will create a very simple Visual that draws a rectangle.
Visuals are defined by:</p>
<ol class="arabic simple">
<li>Creating a subclass of vispy.visuals.Visual</li>
<li>Defining a draw() method that takes into account some user-specified
transformation functions.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example is based on <code class="docutils literal"><span class="pre">vispy.gloo</span></code> and thus uses GLSL
shading code, which is executed at the GPU and is
defined as multiline strings.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">vispy</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">gloo</span><span class="p">,</span> <span class="n">visuals</span><span class="p">,</span> <span class="n">scene</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># Define a simple vertex shader. We use $template variables as placeholders for</span>
<span class="c"># code that will be inserted later on. In this example, $position will become</span>
<span class="c"># an attribute, and $transform will become a function. Important: using</span>
<span class="c"># $transform in this way ensures that users of this visual will be able to</span>
<span class="c"># apply arbitrary transformations to it.</span>
<span class="n">vertex_shader</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">void main() {</span>
<span class="s">   gl_Position = $transform(vec4($position, 0, 1));</span>
<span class="s">}</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="c"># Very simple fragment shader. Again we use a template variable &quot;$color&quot;, which</span>
<span class="c"># allows us to decide later how the color should be defined (in this case, we</span>
<span class="c"># will just use a uniform red color).</span>
<span class="n">fragment_shader</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">void main() {</span>
<span class="s">  gl_FragColor = $color;</span>
<span class="s">}</span>
<span class="s">&quot;&quot;&quot;</span>


<span class="c"># Start the new Visual class.</span>
<span class="c"># By convention, all Visual subclass names end in &#39;Visual&#39;.</span>
<span class="c"># (Custom visuals may ignore this convention, but for visuals that are built</span>
<span class="c"># in to vispy, this is required to ensure that the VisualNode subclasses are</span>
<span class="c"># generated correctly.)</span>
<span class="k">class</span> <span class="nc">MyRectVisual</span><span class="p">(</span><span class="n">visuals</span><span class="o">.</span><span class="n">Visual</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Visual that draws a red rectangle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float</span>
<span class="sd">        x coordinate of rectangle origin</span>
<span class="sd">    y : float</span>
<span class="sd">        y coordinate of rectangle origin</span>
<span class="sd">    w : float</span>
<span class="sd">        width of rectangle</span>
<span class="sd">    h : float</span>
<span class="sd">        height of rectangle</span>

<span class="sd">    All parameters are specified in the local (arbitrary) coordinate system of</span>
<span class="sd">    the visual. How this coordinate system translates to the canvas will</span>
<span class="sd">    depend on the transformation functions used during drawing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># There are no constraints on the signature of the __init__ method; use</span>
    <span class="c"># whatever makes the most sense for your visual.</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="n">visuals</span><span class="o">.</span><span class="n">Visual</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># vertices for two triangles forming a rectangle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbo</span> <span class="o">=</span> <span class="n">gloo</span><span class="o">.</span><span class="n">VertexBuffer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">],</span>
            <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

        <span class="c"># We use a ModularProgram because it allows us to plug in arbitrary</span>
        <span class="c"># transformation functions. This is recommended but not strictly</span>
        <span class="c"># required.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">visuals</span><span class="o">.</span><span class="n">shaders</span><span class="o">.</span><span class="n">ModularProgram</span><span class="p">(</span><span class="n">vertex_shader</span><span class="p">,</span>
                                                      <span class="n">fragment_shader</span><span class="p">)</span>

        <span class="c"># Assign values to the $position and $color template variables in</span>
        <span class="c"># the shaders. ModularProgram automatically handles generating the</span>
        <span class="c"># necessary attribute and uniform declarations with unique variable</span>
        <span class="c"># names.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">vert</span><span class="p">[</span><span class="s">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vbo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">frag</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c"># The draw method is required to take a single argument that will be an</span>
    <span class="c"># instance of visuals.transforms.TransformSystem.</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transforms</span><span class="p">):</span>
        <span class="c"># The TransformSystem provides information about:</span>
        <span class="c">#</span>
        <span class="c"># * The transformation requested by the user (usually translation,</span>
        <span class="c">#   rotation, and scaling)</span>
        <span class="c"># * The canvas dpi and the size of logical pixels</span>
        <span class="c"># * The relationship between physical pixels and logical pixels, which</span>
        <span class="c">#   is important for some high-resolution displays and when exporting</span>
        <span class="c">#   to images</span>

        <span class="c"># For the simple case of this visual, all we need to know is how to</span>
        <span class="c"># convert from the user-specified coordinates (x, y, w, h) to the</span>
        <span class="c"># normalized device coordinates required by the vertex shader. We will</span>
        <span class="c"># explore other uses of the TransformSystem in later tutorials.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">vert</span><span class="p">[</span><span class="s">&#39;transform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">get_full_transform</span><span class="p">()</span>

        <span class="c"># Finally, draw the triangles.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s">&#39;triangles&#39;</span><span class="p">)</span>


<span class="c"># At this point the visual is ready to use, but it takes some extra effort to</span>
<span class="c"># set up a Canvas and TransformSystem for drawing (the examples in</span>
<span class="c"># examples/basics/visuals/ all follow this approach).</span>
<span class="c">#</span>
<span class="c"># An easier approach is to make the visual usable in a scenegraph, in which</span>
<span class="c"># case the canvas will take care of drawing the visual and setting up the</span>
<span class="c"># TransformSystem for us.</span>
<span class="c">#</span>
<span class="c"># To be able to use our new Visual in a scenegraph, it needs to be</span>
<span class="c"># a subclass of scene.Node. In vispy we achieve this by creating a parallel</span>
<span class="c"># set of classes that inherit from both Node and each Visual subclass.</span>
<span class="c"># This can be done automatically using scene.visuals.create_visual_node():</span>
<span class="n">MyRect</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">visuals</span><span class="o">.</span><span class="n">create_visual_node</span><span class="p">(</span><span class="n">MyRectVisual</span><span class="p">)</span>

<span class="c"># By convention, these classes have the same name as the Visual they inherit</span>
<span class="c"># from, but without the &#39;Visual&#39; suffix.</span>

<span class="c"># The auto-generated class MyRect is basically equivalent to::</span>
<span class="c">#</span>
<span class="c">#     class MyRect(MyRectVisual, scene.Node):</span>
<span class="c">#        def __init__(self, *args, **kwds):</span>
<span class="c">#            parent = kwds.pop(&#39;parent&#39;, None)</span>
<span class="c">#            name = kwds.pop(&#39;name&#39;, None)</span>
<span class="c">#            MyRectVisual.__init__(self, *args, **kwds)</span>
<span class="c">#            Node.__init__(self, parent=parent, name=name)</span>
<span class="c">#</span>


<span class="c"># Finally we will test the visual by displaying in a scene.</span>

<span class="c"># Create a canvas to display our visual</span>
<span class="n">canvas</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">SceneCanvas</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="s">&#39;interactive&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Create two instances of MyRect, each using canvas.scene as their parent</span>
<span class="n">rects</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">canvas</span><span class="o">.</span><span class="n">scene</span><span class="p">),</span>
         <span class="n">MyRect</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">canvas</span><span class="o">.</span><span class="n">scene</span><span class="p">)]</span>

<span class="c"># To test that the user-specified transforms work correctly, I&#39;ll rotate</span>
<span class="c"># one rectangle slightly.</span>
<span class="n">tr</span> <span class="o">=</span> <span class="n">visuals</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">AffineTransform</span><span class="p">()</span>
<span class="n">tr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">rects</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">tr</span>

<span class="c"># ..and optionally start the event loop</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">interactive</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>


        </div>
        <div class="span3">

<div class="clearfix"></div> <h4 class="sidebar-box-heading">Download</h4>
<div class="well sidebar-box">
    <ul class="nav nav-list">
        <li><a class="reference external"
                href="https://pypi.python.org/pypi/vispy">Latest release from Pypi</a></li>
        <li><a href="https://github.com/vispy/vispy/archive/master.zip">Bleeding edge</a></li>
    </ul>
</div>
<h4 class="sidebar-box-heading">Links</h4>
<div class="well sidebar-box">
    <ul class="nav nav-list">
        <li><a class="reference external"
                href="https://github.com/vispy/vispy/issues">Issue tracker</a></li>
        <li><a class="reference external"
                href="https://github.com/vispy/vispy/wiki">Project wiki</a></li>
        <li><a class="reference external"
                href="http://groups.google.com/group/vispy">User mailing list</a></li>
        <li><a class="reference external"
                href="http://groups.google.com/group/vispy-dev">Dev mailing list</a></li>
        <li><a class="reference external"
                href="https://gitter.im/vispy/vispy">Dev chat room</a></li>
    </ul>
</div>
<h4 class="sidebar-box-heading">Related Projects</h4>
<div class="well sidebar-box">
    <ul class="nav nav-list">
        <li><a class="reference external"
                href="http://pyopengl.sourceforge.net/">PyOpenGL</a></li>
        <li><a class="reference external"
                href="http://www.pyqtgraph.org/">PyQtGraph</a></li>
        <li><a class="reference external"
                href="http://rossant.github.io/galry/">Galry</a></li>
        <li><a class="reference external"
                href="http://code.google.com/p/glumpy/">Glumpy</a></li>
        <li><a class="reference external"
                href="http://code.google.com/p/visvis/">Visvis</a></li>
    </ul>
</div>
        </div>
    </div>
    <div class="well footer">
        <small>
            &copy; Copyright the vispy development team.
            Created using <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.
            Theme by <a href="http://scikit-image.org/">scikit-image</a>.
        </small>
    </div>
</body>
</html>